<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESL Class Timer</title>
<style>
:root {
  --red:#c4161c;
  --orange:#ff6600;
  --blue:#003a8f;
  --light:#f5f7fa;
}
body {margin:0; padding:1rem; font-family:system-ui,sans-serif; background:var(--light);}
header{text-align:center;margin-bottom:1rem;}
h1{color:var(--red); margin:0.3rem 0; font-size:2rem;}
#branch{color:var(--blue); font-weight:600;}

.container {display:flex;gap:1rem;flex-wrap:wrap;}
.panel {background:white; border-radius:12px; padding:1rem; flex:1; min-width:280px; border-top:5px solid var(--red);}
#timer{font-size:4rem; color:var(--blue); margin:0.5rem 0;}
#activityTitle{font-size:2rem; font-weight:600; margin:0.3rem 0;}
.progress{height:20px; background:#ddd; border-radius:10px; overflow:hidden; margin-top:0.5rem;}
.bar{height:100%; background:var(--blue); width:100%;}
.warning{color:var(--red); animation:blink 1s infinite;}
.alert5min{color:var(--orange); animation:blink 1s infinite;}
@keyframes blink{50%{opacity:0;}}
button{margin:0.2rem 0;padding:0.4rem;font-size:1rem;border:none;border-radius:6px;background:var(--blue);color:white;cursor:pointer;}
button.red{background:var(--red);}
button.small{width:30px;padding:0.2rem;font-size:0.8rem;}
.activity{display:flex;gap:0.3rem;margin-bottom:0.4rem;padding:0.2rem;border-radius:6px;background:#e3f1ff;align-items:center;}
.activity input[type="text"]{flex:2; font-size:1rem; padding:0.2rem;}
.activity input[type="number"]{width:50px; font-size:1rem; padding:0.2rem;}
.activity input[type="text"].note{flex:2; font-size:0.9rem; padding:0.2rem;}
.break{background:#ffe5e5;}
@media(max-width:768px){
  .container{flex-direction:column;}
  #timer{font-size:3rem;}
  #activityTitle{font-size:1.5rem;}
  .activity input[type="text"], .activity input[type="text"].note{flex:3;}
}
</style>
</head>
<body>

<header>
  <h1>ESL Class Timer</h1>
  <div id="branch">VUS Hoa Binh Campus</div>
</header>

<div class="container">

<div class="panel">
  <h3>Lesson Templates</h3>
  <button onclick="loadTemplate(90)">90 minutes</button>
  <button onclick="loadTemplate(120)">120 minutes</button>

  <h3>Lesson</h3>
  <button class="red" onclick="saveLesson()">Save lesson</button>
  <button onclick="loadLesson()">Load lesson</button>

  <h3>Activities</h3>
  <div id="activities"></div>
  <button onclick="addActivity()">âž• Add Activity</button>
  <button onclick="addBreak()">â˜• Break</button>
</div>

<div class="panel" style="text-align:center;">
  <div id="activityTitle">Ready</div>
  <div id="timer">00:00</div>
  <div class="progress"><div id="bar" class="bar"></div></div>
  <button onclick="start()">Start</button>
  <button onclick="pause()">Pause</button>
  <button onclick="next()">Next</button>
</div>

</div>

<audio id="ding" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>
<audio id="ding5" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let activities=[]; let index=0; let remaining=0; let total=0; let interval=null;
const actDiv=document.getElementById("activities");
const timerEl=document.getElementById("timer");
const bar=document.getElementById("bar");
const current=document.getElementById("activityTitle");
const ding=document.getElementById("ding");
const ding5=document.getElementById("ding5");

function render(){
  actDiv.innerHTML="";
  activities.forEach((a,i)=>{
    const d=document.createElement("div");
    d.className="activity"+(a.break?" break":"");
    d.innerHTML=`
      <input type="text" value="${a.name}">
      <input type="number" min="5" max="80" value="${a.min}">
      <input type="text" class="note" placeholder="Note..." value="${a.note||''}">
      <button class="small">ðŸ¦„</button>
    `;
    const inputs=d.querySelectorAll("input");
    inputs[0].onchange=e=>a.name=e.target.value;
    inputs[1].onchange=e=>a.min=+e.target.value;
    inputs[2].onchange=e=>a.note=e.target.value;
    d.querySelector("button").onclick=()=>{
      activities.splice(i,1);
      render();
    };
    actDiv.appendChild(d);
  });
}

function update(){
  const m=Math.floor(remaining/60);
  const s=remaining%60;
  timerEl.textContent=`${m}:${s.toString().padStart(2,"0")}`;
  bar.style.width=`${remaining/total*100}%`;
  if(remaining<=120) timerEl.className="warning";
  else if(remaining<=300) timerEl.className="alert5min";
  else timerEl.className="";
}

function start(){
  if(interval||!activities[index])return;
  remaining=activities[index].min*60;
  total=remaining;
  current.textContent=activities[index].name;
  interval=setInterval(()=>{
    remaining--;
    update();
    if(remaining===300) ding5.play();
    if(remaining<=0){
      clearInterval(interval);
      interval=null;
      index++;
      if(activities[index]) start();
      else{
        current.textContent="Class finished ðŸŽ‰";
        timerEl.textContent="00:00";
      }
      ding.play();
    }
  },1000);
}

function pause(){clearInterval(interval); interval=null;}
function next(){pause(); index++; if(activities[index]) start(); else {current.textContent="Class finished ðŸŽ‰"; timerEl.textContent="00:00";}}

function addActivity(){activities.push({name:"New Activity",min:10,note:""}); render();}
function addBreak(){activities.push({name:"Break",min:10,break:true,note:""}); render();}

function saveLesson(){localStorage.setItem("lesson",JSON.stringify(activities)); alert("Lesson saved âœ”");}
function loadLesson(){const s=localStorage.getItem("lesson"); if(!s)return alert("No saved lesson"); activities=JSON.parse(s); index=0; render();}

function loadTemplate(t){
  index=0;
  activities = t===90 ? [
    {name:"Warm-up",min:10,note:""},
    {name:"Vocabulary",min:20,note:""},
    {name:"Break",min:10,break:true,note:""},
    {name:"Speaking",min:30,note:""},
    {name:"Game / Review",min:20,note:""}
  ] : [
    {name:"Warm-up",min:10,note:""},
    {name:"Vocabulary",min:25,note:""},
    {name:"Listening",min:25,note:""},
    {name:"Break",min:10,break:true,note:""},
    {name:"Speaking",min:30,note:""},
    {name:"Game / Review",min:20,note:""}
  ];
  render();
}
</script>
</body>
</html>
