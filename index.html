<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESL Class Timer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
  --red: #c4161c;
  --orange: #ff6600;
  --blue: #003a8f;
  --light: #f5f7fa;
  --white: #ffffff;
}

body {
  margin:0; padding:0;
  font-family: system-ui, sans-serif;
  background: var(--light);
  display:flex; flex-direction:column; min-height:100vh;
}

header {
  text-align:center; padding:0.5rem;
  background: var(--white); border-bottom:3px solid var(--red);
}
h1 {margin:0.3rem 0; font-size:2rem; color: var(--red);}
#branch {color: var(--blue); font-weight:600; font-size:1rem;}

.main-container {
  flex:1; display:flex; flex-direction:column; padding:0.5rem; gap:0.5rem; overflow:auto;
}

/* Activities Panel */
.panel {background:white; border-radius:12px; padding:1rem; display:flex; flex-direction:column; gap:0.5rem;}
.activities-container {display:flex; flex-direction:column; gap:0.4rem; max-height:300px; overflow-y:auto;}
.activity {
  display:flex; flex-direction:column; background:#e3f1ff; border-radius:6px; padding:0.3rem; gap:0.2rem;
}
.activity.break {background:#ffe5e5;}
.activity input[type="text"], .activity input.note {font-size:1.2rem; padding:0.3rem; width:100%; border-radius:4px; border:1px solid #ccc;}
.activity input[type="number"] {width:80px; font-size:1.2rem; padding:0.3rem; border-radius:4px; border:1px solid #ccc;}
.activity button.deleteBtn {background:var(--blue); color:white; border:none; border-radius:6px; font-size:1.2rem; padding:0.5rem; cursor:pointer; width:50px; align-self:flex-end;}
.activity button.deleteBtn:hover {opacity:0.8;}

/* Timer Panel */
#timerPanel {background:white; border-radius:12px; padding:1rem; text-align:center; display:flex; flex-direction:column; gap:0.3rem;}
#activityContent {transition:opacity 0.5s ease; opacity:1;}
#activityTitle {font-size:2.5rem; font-weight:600; margin:0.3rem 0;}
#activityNote {font-size:1rem; color:#333; min-height:40px;}
#timer {font-size:4rem; color: var(--blue); margin:0.3rem 0;}
.progress {height:25px; background:#ddd; border-radius:12px; overflow:hidden;}
.bar {height:100%; background: var(--blue); width:100%;}
.warning {color: var(--red); animation: blink 1s infinite;}
.alert5min {color: var(--orange); animation: blink 1s infinite;}
@keyframes blink{50%{opacity:0;}}

/* Buttons */
button.mainBtn {font-size:1.5rem; padding:0.8rem; border:none; border-radius:8px; cursor:pointer; margin:0.2rem 0;}
button.startBtn {background:var(--blue); color:white;}
button.pauseBtn {background:var(--red); color:white;}
button.nextBtn {background:var(--blue); color:white;}
button.templateBtn {background:var(--blue); color:white; border:none; border-radius:8px; padding:0.6rem; font-size:1.2rem; margin:0.2rem 0;}
button.saveBtn {background:var(--red); color:white; border:none; border-radius:8px; padding:0.6rem; font-size:1.2rem; margin:0.2rem 0;}

/* Responsive */
@media(min-width:768px){
  .main-container {
    flex-direction:row;
    gap: 1rem;
  }
  .panel {flex:1;}
  .activities-container {max-height:none;}
  #activityTitle {font-size: 3rem;}
  #timer {font-size:5rem;}
  button.mainBtn {font-size:1.8rem; padding:1rem;}
}

@media(min-width:1024px){
  .main-container {gap: 2rem;}
  .panel {padding:2rem; border-radius:16px;}
  #activityTitle {font-size:3.5rem;}
  #timer {font-size:6rem;}
  .activity input[type="text"], .activity input.note {font-size:1.4rem; padding:0.5rem;}
  button.mainBtn {font-size:2rem; padding:1.2rem;}
  #timerPanel {flex:0 0 400px; position:sticky; top:1rem; height:fit-content;}
}
</style>
</head>
<body>

<header>
  <h1>ESL Class Timer</h1>
  <div id="branch">VUS Hoa Binh Campus</div>
</header>

<div class="main-container">

  <!-- Activities Panel -->
  <div class="panel">
    <h3>Lesson Templates</h3>
    <button class="templateBtn" onclick="loadTemplate(90)">90 minutes</button>
    <button class="templateBtn" onclick="loadTemplate(120)">120 minutes</button>

    <h3>Lesson</h3>
    <button class="saveBtn" onclick="saveLesson()">Save lesson</button>
    <button class="templateBtn" onclick="loadLesson()">Load lesson</button>

    <h3>Activities</h3>
    <div class="activities-container" id="activities"></div>

    <button class="templateBtn" onclick="addActivity()">âž• Add Activity</button>
    <button class="templateBtn" onclick="addBreak()">â˜• Break</button>
  </div>

  <!-- Timer Panel -->
  <div class="panel" id="timerPanel">
    <div id="activityContent">
      <div id="activityTitle">Ready</div>
      <div id="activityNote"></div>
    </div>
    <div id="timer">00:00</div>
    <div class="progress"><div id="bar" class="bar"></div></div>

    <button class="mainBtn startBtn" onclick="start()">Start</button>
    <button class="mainBtn pauseBtn" onclick="pause()">Pause</button>
    <button class="mainBtn nextBtn" onclick="next()">Next</button>
  </div>

</div>

<!-- Kid-friendly sounds (MP3 for mobile compatibility) -->
<audio id="ding3" src="https://cdn.pixabay.com/audio/2022/03/15/audio_1f8f3e14.mp3"></audio>
<audio id="ding2" src="https://cdn.pixabay.com/audio/2022/03/15/audio_9e5b8f7d.mp3"></audio>
<audio id="dingEnd" src="https://cdn.pixabay.com/audio/2022/03/15/audio_3a1bcb55.mp3"></audio>

<script>
let activities=[], index=0, remaining=0, total=0, interval=null;
let ding3Played=false, ding2Played=false, dingEndPlayed=false;
const actDiv=document.getElementById("activities");
const timerEl=document.getElementById("timer");
const bar=document.getElementById("bar");
const current=document.getElementById("activityTitle");
const noteEl=document.getElementById("activityNote");
const content=document.getElementById("activityContent");
const ding3=document.getElementById("ding3");
const ding2=document.getElementById("ding2");
const dingEnd=document.getElementById("dingEnd");

function render(){
  actDiv.innerHTML="";
  activities.forEach((a,i)=>{
    const d=document.createElement("div");
    d.className="activity"+(a.break?" break":"");
    d.innerHTML=`
      <input type="text" value="${a.name}" placeholder="Activity Name">
      <input type="number" min="5" max="80" value="${a.min}">
      <input type="text" class="note" placeholder="Note..." value="${a.note||''}">
      <button class="deleteBtn">ðŸ¦„</button>
    `;
    const inputs=d.querySelectorAll("input");
    inputs[0].onchange=e=>a.name=e.target.value;
    inputs[1].onchange=e=>a.min=+e.target.value;
    inputs[2].onchange=e=>a.note=e.target.value;
    d.querySelector("button").onclick=()=>{activities.splice(i,1); render();};

    if(i===index) d.style.border="2px solid var(--blue)"; else d.style.border="none";
    actDiv.appendChild(d);
  });

  const currentAct = actDiv.children[index];
  if(currentAct) currentAct.scrollIntoView({behavior:"smooth", block:"center"});
}

function update(){
  const m=Math.floor(remaining/60);
  const s=remaining%60;
  timerEl.textContent=`${m}:${s.toString().padStart(2,"0")}`;
  bar.style.width=`${remaining/total*100}%`;
  if(remaining<=120) timerEl.className="warning";
  else if(remaining<=300) timerEl.className="alert5min";
  else timerEl.className="";
}

function showActivity(a){
  content.style.opacity=0;
  setTimeout(()=>{
    current.textContent=a.name;
    noteEl.textContent=a.note||'';
    remaining=a.min*60; total=remaining;
    ding3Played=ding2Played=dingEndPlayed=false;
    update();
    content.style.opacity=1;
  },300);
}

function start(){
  if(interval||!activities[index]) return;
  render();
  showActivity(activities[index]);
  interval=setInterval(()=>{
    remaining--;
    update();

    if(remaining===180 && !ding3Played){ ding3.play(); ding3Played=true;}
    if(remaining===120 && !ding2Played){ ding2.play(); setTimeout(()=>ding2.play(),300); ding2Played=true;}
    if(remaining<=0 && !dingEndPlayed){ dingEnd.play(); setTimeout(()=>dingEnd.play(),300); setTimeout(()=>dingEnd.play(),600); dingEndPlayed=true;}

    if(remaining<=0){
      clearInterval(interval); interval=null;
      index++;
      if(activities[index]) start();
      else{current.textContent="Class finished ðŸŽ‰"; noteEl.textContent=""; timerEl.textContent="00:00";}
    }
  },1000);
}

function pause(){clearInterval(interval); interval=null;}
function next(){pause(); index++; if(activities[index]) start(); else{current.textContent="Class finished ðŸŽ‰"; noteEl.textContent=""; timerEl.textContent="00:00";}}
function addActivity(){activities.push({name:"New Activity",min:10,note:""}); render();}
function addBreak(){activities.push({name:"Break",min:10,break:true,note:""}); render();}
function saveLesson(){localStorage.setItem("lesson",JSON.stringify(activities)); alert("Lesson saved âœ”");}
function loadLesson(){const s=localStorage.getItem("lesson"); if(!s) return alert("No saved lesson"); activities=JSON.parse(s); index=0; render();}
function loadTemplate(t){
  index=0;
  activities = t===90 ? [
    {name:"Warm-up",min:10,note:""},
    {name:"Vocabulary",min:20,note:""},
    {name:"Break",min:10,break:true,note:""},
    {name:"Speaking",min:30,note:""},
    {name:"Game / Review",min:20,note:""}
  ] : [
    {name:"Warm-up",min:10,note:""},
    {name:"Vocabulary",min:25,note:""},
    {name:"Listening",min:25,note:""},
    {name:"Break",min:10,break:true,note:""},
    {name:"Speaking",min:30,note:""},
    {name:"Game / Review",min:20,note:""}
  ];
  render();
}
</script>
</body>
</html>
